<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nova Translator | ZOX Robotics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #232a3a 0%, #3b527b 100%);
      color: #fff;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .logo-bar {
      width: 100vw;
      display: flex;
      justify-content: center;
      margin-top: 2em;
      margin-bottom: 0.5em;
    }
    .logo-bar img {
      width: 160px;
      object-fit: contain;
      box-shadow: 0 2px 12px #13f5ff66;
      border-radius: 16px;
      border: 2.5px solid #10c6ff88;
      background: #fff;
      padding: 0.4em 1.5em 0.2em 1.5em;
    }
    .container {
      max-width: 750px;
      width: 98vw;
      background: #181c38;
      border-radius: 32px;
      box-shadow: 0 10px 32px #00a2ff55, 0 3px 24px #0004;
      padding: 2.1em 2.1em 2.2em 2.1em;
      margin: 0 auto;
      border: 2.5px solid #21c8ff33;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h2 {
      font-size: 2.1rem;
      margin-bottom: 1.1em;
      font-weight: 900;
      letter-spacing: 2.3px;
      background: linear-gradient(90deg, #21c8ff 23%, #ff6ae7 87%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-top: 0;
      text-align: center;
      text-shadow: 0 4px 18px #09ffe3a2;
    }
    .flip-row {
      display: flex;
      width: 100%;
      gap: 1.1em;
      align-items: flex-end;
      justify-content: center;
      margin-bottom: 1.1em;
    }
    .lang-panel {
      flex: 1;
      min-width: 180px;
      max-width: 310px;
      background: linear-gradient(120deg, #222a45 60%, #242a5c 100%);
      padding: 1.1em 1.1em 1.25em 1.1em;
      border-radius: 22px;
      box-shadow: 0 2px 12px #13f7ff24;
      display: flex;
      flex-direction: column;
      position: relative;
      border: 2px solid #5ad0fd33;
      min-height: 140px;
    }
    .label {
      color: #2cffb9;
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 0.32em;
      letter-spacing: 0.03em;
      text-shadow: 0 2px 8px #12fff9a0;
    }
    .lang-select-row {
      display: flex;
      gap: 0.4em;
      align-items: center;
      margin-bottom: 0.2em;
    }
    select {
      flex: 1;
      padding: 0.4em 0.9em;
      border-radius: 11px;
      border: 1.7px solid #28f3e988;
      background: #232e48;
      color: #fff;
      font-size: 1rem;
      font-weight: 700;
      outline: none;
    }
    textarea, .output-box {
      width: 100%;
      margin: 0.12em auto 0.1em auto;
      border-radius: 14px;
      font-size: 1.13rem;
      background: #232a3a;
      color: #fff;
      border: none;
      padding: 1em 1em;
      box-shadow: 0 2px 9px #00fff324;
      outline: none;
      transition: box-shadow 0.2s;
      resize: none;
      min-height: 60px;
      font-weight: 500;
    }
    .output-box {
      background: #171b33;
      border: 2px solid #00f2ff28;
      font-weight: 800;
      font-size: 1.13rem;
      text-shadow: 0 1px 7px #00f8ff17;
      min-height: 60px;
      display: flex;
      align-items: center;
    }
    .btn-row {
      display: flex;
      width: 100%;
      justify-content: center;
      gap: 1em;
      margin-top: 1.0em;
      margin-bottom: 0.3em;
      flex-wrap: wrap;
    }
    .assistant-btn {
      padding: 0.72em 1.2em;
      font-size: 1.07rem;
      font-weight: 800;
      border: none;
      border-radius: 13px;
      background: linear-gradient(90deg, #21c8ff 30%, #ff6ae7 100%);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 1px 7px #00fff44a;
      transition: background 0.16s, transform 0.11s;
      outline: none;
      font-family: inherit;
      margin-bottom: 0.08em;
      margin-right: 0.1em;
    }
    .assistant-btn.active {
      background: linear-gradient(90deg, #38ff98 30%, #0ff4fa 100%);
      color: #00151f;
      font-weight: 900;
      border: 2px solid #25ffa5;
    }
    @media (max-width: 800px) {
      .flip-row { flex-direction: column; gap: 1em; }
      .container { padding: 0.6em 0.3em; border-radius: 0; }
    }
  </style>
</head>
<body>
  <div class="logo-bar">
    <img src="Logo-ZOX-Robotics-1-1.png" alt="ZOX Robotics Logo" id="zoxLogo">
  </div>
  <div class="container">
    <h2>Nova Translator</h2>
    <div class="flip-row">
      <div class="lang-panel">
        <div class="label">Input Language</div>
        <div class="lang-select-row">
          <select id="inputLang">
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="zh">Chinese (Simplified)</option>
            <option value="hi">Hindi</option>
            <option value="ar">Arabic</option>
            <option value="ru">Russian</option>
            <option value="ja">Japanese</option>
            <option value="pt">Portuguese</option>
            <option value="it">Italian</option>
          </select>
        </div>
        <textarea id="inputText" placeholder="Type or speak..."></textarea>
      </div>
      <div class="lang-panel">
        <div class="label">Target Language</div>
        <div class="lang-select-row">
          <select id="outputLang">
            <option value="es">Spanish</option>
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="zh">Chinese (Simplified)</option>
            <option value="hi">Hindi</option>
            <option value="ar">Arabic</option>
            <option value="ru">Russian</option>
            <option value="ja">Japanese</option>
            <option value="pt">Portuguese</option>
            <option value="it">Italian</option>
          </select>
        </div>
        <div id="translatedText" class="output-box"></div>
      </div>
    </div>
    <div class="btn-row">
      <button class="assistant-btn" id="assistantBtn">Start Assistant</button>
    </div>
  </div>
  <script>
    const langMap = {
      en: "English", es: "Spanish", fr: "French", de: "German", zh: "Chinese (Simplified)", hi: "Hindi",
      ar: "Arabic", ru: "Russian", ja: "Japanese", pt: "Portuguese", it: "Italian"
    };
    const langCodeMap = {
      en: "en-US", es: "es-ES", fr: "fr-FR", de: "de-DE", zh: "zh-CN", hi: "hi-IN",
      ar: "ar-SA", ru: "ru-RU", ja: "ja-JP", pt: "pt-PT", it: "it-IT"
    };
    const inputLang = document.getElementById('inputLang');
    const outputLang = document.getElementById('outputLang');
    const inputText = document.getElementById('inputText');
    const translatedText = document.getElementById('translatedText');
    const assistantBtn = document.getElementById('assistantBtn');

    let recognition = null;
    let isListening = false;
    let botState = 'init';

    assistantBtn.onclick = () => {
      if (isListening) stopAssistant();
      else startAssistant();
    };

    function startAssistant() {
      isListening = true;
      assistantBtn.textContent = "Assistant Listening... (Click to stop)";
      assistantBtn.classList.add('active');
      speak("Hello! Which languages do you want to translate from and to?");
      botState = 'setLang';
      setTimeout(() => listenOnce(), 1300);
    }

    function stopAssistant() {
      isListening = false;
      if (recognition) recognition.abort();
      assistantBtn.textContent = "Start Assistant";
      assistantBtn.classList.remove('active');
      speak("Assistant stopped. Goodbye.");
      botState = 'init';
    }

    function listenOnce() {
      if (!isListening) return;
      if (!('webkitSpeechRecognition' in window)) {
        alert('Speech recognition not supported in this browser.');
        return;
      }
      if (recognition) recognition.abort();
      recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = async (event) => {
        const spokenText = event.results[0][0].transcript.trim();
        if (botState === 'setLang') {
          if (await setLanguagesFromSpeech(spokenText)) {
            speak(`Input language is ${langMap[inputLang.value]}, target language is ${langMap[outputLang.value]}. What would you like to translate?`);
            botState = 'ready';
          } else {
            speak("Sorry, I didn't catch the languages. Please say, for example, from Italian to Spanish.");
            setTimeout(() => listenOnce(), 1400);
            return;
          }
          setTimeout(() => listenOnce(), 2000);
        } else if (botState === 'ready') {
          if (/change languages?/i.test(spokenText)) {
            speak("Which languages do you want to translate from and to?");
            botState = 'setLang';
            setTimeout(() => listenOnce(), 1200);
            return;
          }
          if (/stop( assistant| bot| listening)?/i.test(spokenText)) {
            stopAssistant();
            return;
          }
          inputText.value = spokenText;
          botState = 'translating';
          await translateAndSpeak();
          botState = 'ready';
          speak("Say another phrase to translate, or say 'change languages' to switch.");
          setTimeout(() => listenOnce(), 2000);
        }
      };

      recognition.onend = () => {
        if (isListening && botState !== 'init') setTimeout(() => listenOnce(), 900);
      };
      recognition.onerror = (event) => {
        if (event.error !== "no-speech" && event.error !== "aborted") {
          speak("Sorry, I didn't catch that.");
        }
        if (isListening && botState !== 'init') setTimeout(() => listenOnce(), 1100);
      };
      recognition.start();
    }

    // Parse language selection like "from Italian to Spanish" or "Italian to Spanish"
    async function setLanguagesFromSpeech(txt) {
      const regexes = [
        /from ([a-z\s]+) to ([a-z\s]+)/i,
        /([a-z\s]+) to ([a-z\s]+)/i,
        /from ([a-z\s]+) into ([a-z\s]+)/i,
        /([a-z\s]+) into ([a-z\s]+)/i
      ];
      for (let rgx of regexes) {
        let match = txt.match(rgx);
        if (match) {
          let fromRaw = match[1].trim(), toRaw = match[2].trim();
          let fromCode = findLangCode(fromRaw);
          let toCode = findLangCode(toRaw);
          if (fromCode && toCode) {
            inputLang.value = fromCode;
            outputLang.value = toCode;
            return true;
          }
        }
      }
      return false;
    }
    function findLangCode(raw) {
      raw = raw.toLowerCase();
      for (const [code, name] of Object.entries(langMap)) {
        if (name.toLowerCase().includes(raw) || raw.includes(name.toLowerCase())) return code;
      }
      return null;
    }

    async function translateAndSpeak() {
      const text = inputText.value.trim();
      const targetLanguage = outputLang.value;
      translatedText.innerText = "";
      if (!text) return;
      try {
        const res = await fetch('https://nova-translator-backend.onrender.com/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, targetLanguage })
        });
        const data = await res.json();
        if (data.translatedText) {
          translatedText.innerText = data.translatedText;
          speak(data.translatedText, targetLanguage);
        } else {
          translatedText.innerText = "Translation failed: " + (data.error || "Unknown error");
          speak("Sorry, translation failed.", inputLang.value);
        }
      } catch (err) {
        translatedText.innerText = "Network or server error: " + err.message;
        speak("Sorry, network or server error.", inputLang.value);
      }
    }
    function speak(text, lang = "en") {
      if ('speechSynthesis' in window && text) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = langCodeMap[lang] || lang || "en-US";
        utter.rate = 1.03;
        utter.volume = 1;
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utter);
      }
    }
  </script>
</body>
</html>
