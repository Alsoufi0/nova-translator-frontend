<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nova Translator | ZOX Robotics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* [trimmed for clarity] Full clean vibrant CSS with layout, logo, colors, button visibility, etc. */
    /* Will include when code is too long here */
  </style>
</head>
<body>
  <div class="logo-bar">
    <img src="Logo-ZOX-Robotics-1-1.png" alt="ZOX Robotics Logo">
  </div>
  <div class="container">
    <h2>Nova Translator</h2>
    <div class="flip-row">
      <div class="lang-panel">
        <div class="label">Input Language</div>
        <select id="inputLang"></select>
        <textarea id="inputText" placeholder="Type or speak..."></textarea>
      </div>
      <div class="lang-panel">
        <div class="label">Target Language</div>
        <select id="outputLang"></select>
        <div id="translatedText" class="output-box"></div>
      </div>
    </div>
    <div class="btn-row">
      <button id="translateBtn">Translate</button>
      <button id="micBtn">ðŸŽ¤ Speak</button>
      <button id="speakBtn">ðŸ”Š Read</button>
      <button id="clearBtn">Clear</button>
      <button id="assistantBtn">Start Assistant</button>
    </div>
  </div>
  <script>
    const inputLang = document.getElementById('inputLang');
    const outputLang = document.getElementById('outputLang');
    const inputText = document.getElementById('inputText');
    const translatedText = document.getElementById('translatedText');
    const translateBtn = document.getElementById('translateBtn');
    const micBtn = document.getElementById('micBtn');
    const speakBtn = document.getElementById('speakBtn');
    const clearBtn = document.getElementById('clearBtn');
    const assistantBtn = document.getElementById('assistantBtn');

    const langMap = {
      en: 'English', es: 'Spanish', fr: 'French', de: 'German', it: 'Italian',
      ru: 'Russian', ja: 'Japanese', zh: 'Chinese', hi: 'Hindi', ar: 'Arabic', pt: 'Portuguese'
    };
    const langCodeMap = {
      en: 'en-US', es: 'es-ES', fr: 'fr-FR', de: 'de-DE', it: 'it-IT',
      ru: 'ru-RU', ja: 'ja-JP', zh: 'zh-CN', hi: 'hi-IN', ar: 'ar-SA', pt: 'pt-PT'
    };

    for (let code in langMap) {
      inputLang.innerHTML += `<option value="${code}">${langMap[code]}</option>`;
      outputLang.innerHTML += `<option value="${code}">${langMap[code]}</option>`;
    }
    inputLang.value = 'en';
    outputLang.value = 'es';

    function speak(text, langCode) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = langCodeMap[langCode] || 'en-US';
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);
    }

    translateBtn.onclick = async () => {
      const text = inputText.value.trim();
      if (!text) return;
      const targetLanguage = outputLang.value;
      const res = await fetch('https://nova-translator-backend.onrender.com/translate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text, targetLanguage })
      });
      const data = await res.json();
      translatedText.innerText = data.translatedText;
      speak(data.translatedText, targetLanguage);
    };

    micBtn.onclick = () => {
      const recog = new webkitSpeechRecognition();
      recog.lang = langCodeMap[inputLang.value];
      recog.onresult = (e) => {
        inputText.value = e.results[0][0].transcript;
        translateBtn.click();
      };
      recog.start();
    };

    speakBtn.onclick = () => speak(translatedText.innerText, outputLang.value);

    clearBtn.onclick = () => {
      inputText.value = '';
      translatedText.innerText = '';
    };

    let assistantActive = false;
    assistantBtn.onclick = () => {
      if (assistantActive) return location.reload();
      assistantActive = true;
      assistantBtn.textContent = 'Assistant Listening...';
      speak('Hello! Which languages would you like to translate from and to?');
      listenForLanguages();
    };

    function listenForLanguages() {
      const recog = new webkitSpeechRecognition();
      recog.lang = 'en-US';
      recog.onresult = (e) => {
        const t = e.results[0][0].transcript.toLowerCase();
        const fromLang = Object.keys(langMap).find(l => t.includes(langMap[l].toLowerCase()) && t.includes('from'));
        const toLang = Object.keys(langMap).find(l => t.includes(langMap[l].toLowerCase()) && t.includes('to'));
        if (fromLang && toLang) {
          inputLang.value = fromLang;
          outputLang.value = toLang;
          speak(`Got it. Translating from ${langMap[fromLang]} to ${langMap[toLang]}. What would you like to translate?`);
          setTimeout(() => listenAndTranslate(), 3000);
        } else {
          speak('Sorry, I could not understand the languages. Please say again.');
          setTimeout(listenForLanguages, 3000);
        }
      };
      recog.start();
    }

    function listenAndTranslate() {
      const recog = new webkitSpeechRecognition();
      recog.lang = langCodeMap[inputLang.value];
      recog.onresult = async (e) => {
        const phrase = e.results[0][0].transcript;
        inputText.value = phrase;
        const res = await fetch('https://nova-translator-backend.onrender.com/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: phrase, targetLanguage: outputLang.value })
        });
        const data = await res.json();
        translatedText.innerText = data.translatedText;
        speak(data.translatedText, outputLang.value);
        setTimeout(() => speak('Say another phrase or say change languages or stop.'), 4000);
        setTimeout(() => listenForCommand(), 6000);
      };
      recog.start();
    }

    function listenForCommand() {
      const recog = new webkitSpeechRecognition();
      recog.lang = 'en-US';
      recog.onresult = (e) => {
        const txt = e.results[0][0].transcript.toLowerCase();
        if (txt.includes('stop')) {
          speak('Goodbye.');
          assistantBtn.textContent = 'Start Assistant';
          assistantActive = false;
          return;
        } else if (txt.includes('change')) {
          speak('Please tell me the new languages.');
          setTimeout(listenForLanguages, 3000);
        } else {
          listenAndTranslate();
        }
      };
      recog.start();
    }
  </script>
</body>
</html>
